---
layout: post
title: Advanced Ray Tracing Part 2
---

In this part of my blog, I continued with the acceleration structures implementation, multisampling and Distirbution Ray Tracing. I also made changes in the overall architecture of my project.  

### Introduction
---
Before starting to implement the new features, I organized the structure of my project which is very helpful for adding new features. So in this part of my blog series, I started to change the structures of the shapes class and its subclasses. I also changed the intersection functions and their return values which is more accurate and compatible for implementation of accelaration structures. These are the overall changes in the architecture of my ray tracer project which I did before adding any more features.

Firstly, as I said above I changed the shapes class and merged with the object class. This class contains one virtual function at the begginnig which is the function for ray object intersection. So I changed the intersection functions as well. Now, they are inherited from the super class named Object. In addition to these, I also changed the elements of the classes Sphere, Triangle and Mesh. I decided that I keep too much information and some of them not used at rendering pipeline. So for more organised and useful architectural design, I decided to decrease the elements that I keep. I also removed the intersection function for Triangle and Mesh and added to Face struct. At the end, my inherited subclasses of object super classes are face and sphere. A I stated, intersection function's return values chaged. Not they are returning a new struct name hit_record which records the properties of the object that I hit. It stores material_id, t value, normal of this object and pointer to this Object(I will come to that in the BVH chapter). with this changes, I generalized the intersection functions for spheres and faces. After I finished the implementation of these classes , I now have a whole new and more convenient subclasses. 

Secondly, since I started to change my overall architecture I decided to changed the generating ray intersection. I defined a class named scene_renderer to keep rendering result, scene struct that I parsed etc. I am defining that so I can keep all of my objects and used them while constructing the BVH tree. I transferred the functions for generating color from ray header to this header since it is more relevant for this header now. I defined a function for putting all the objects to a object vector and I later use that function for constructing BVH tree. I also defined a function for setting the Camera more accurately. I defined that function because later in this project, I will need to use different type of cameras. With this type of notation, I am able to change and adapt easily. After the implementation of this scene class, I am able to finish the architectural changes in my project. So now I can safely and happly start the implementation of these new features.

*Note: Last time, I had a bug in the transparency so I leave it as this blogs work. This week after I changed the overall architecture of the project, I noticed the my problem. I was mistaking while constructing the refractiona and reclection rays. I was giving the origin of the ray wrong. So after I changed that the image is become normal.*


### BVH Structure and Classes
---

### Multisampling and Distribution Ray Tracing
---

### Implementation
---

### Future Tasks
---


## Images
---
